<div class="p-6 space-y-6">

  <!-- Page Title -->
  <h1 class="text-3xl font-bold text-[var(--primary)]">
    Model Training Dashboard
  </h1>

<!-- === Train Parameters Form === -->
<div class="grid md:grid-cols-2 gap-4">
  <div class="relative">
    <div>
  <label class="block text-sm font-medium text-[var(--text)] flex items-center gap-2">
    Loss
    <span class="relative group cursor-pointer inline-flex items-center text-gray-400">
      <span class="material-icons h-4 w-4 select-none mb-2">info</span>
      <div
        class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity z-50 whitespace-normal">
        The logistic loss function is used to help the model distinguish between relevant and irrelevant recommendations.
      </div>
    </span>
  </label>
  <p class="p-2 rounded border bg-[var(--surface)] text-[var(--text)]">Logistic</p>
</div>
  </div>

  <div class="relative">
    <label class="block text-sm font-medium text-[var(--text)] flex items-center gap-2">
      Learning Rate
      <span class="relative group cursor-pointer inline-flex items-center text-gray-400">
        <span class="material-icons h-4 w-4 select-none mb-2">info</span>
        <div
          class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity z-50 whitespace-normal">
          How big each step is when the model tries to improve.
Too big a step can miss the goal, too small makes learning slow.
        </div>
      </span>
    </label>
    <input type="number" step="0.0001" [(ngModel)]="trainParams.learning_rate" class="w-full p-2 rounded border bg-[var(--surface)] text-[var(--text)]" />
  </div>

  <div class="relative">
    <label class="block text-sm font-medium text-[var(--text)] flex items-center gap-2">
      Epochs
      <span class="relative group cursor-pointer inline-flex items-center text-gray-400">
        <span class="material-icons h-4 w-4 select-none mb-2">info</span>
        <div
          class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity z-50 whitespace-normal">
          How many times the model looks at all the training data to learn.
More passes can mean better learning but take longer time.
        </div>
      </span>
    </label>
    <input type="number" [(ngModel)]="trainParams.epochs" class="w-full p-2 rounded border bg-[var(--surface)] text-[var(--text)]" />
  </div>

  <div class="relative">
    <label class="block text-sm font-medium text-[var(--text)] flex items-center gap-2">
      No. of Components
      <span class="relative group cursor-pointer inline-flex items-center text-gray-400">
        <span class="material-icons h-4 w-4 select-none mb-2">info</span>
        <div
          class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity z-50 whitespace-normal">
How many key parts or features the model focuses on to understand data patterns.
Choosing the right number helps the model see the important details without getting confused.
        </div>
      </span>
    </label>
    <input type="number" [(ngModel)]="trainParams.no_components" class="w-full p-2 rounded border bg-[var(--surface)] text-[var(--text)]" />
  </div>
</div>

<!-- === Tune Parameters Form === -->
<div class="grid md:grid-cols-2 gap-4 mt-4">
  <div class="relative">
    <label class="block text-sm font-medium text-[var(--text)] flex items-center gap-2">
      Tune - Trials
      <span class="relative group cursor-pointer inline-flex items-center text-gray-400">
        <span class="material-icons h-4 w-4 select-none mb-2">info</span>
        <div
          class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity z-50 whitespace-normal">
          Number of times the system will try different settings to find the best one.
          Like testing many recipes to find the tastiest cake.
        </div>
      </span>
    </label>
    <input type="number" [(ngModel)]="tuneParams.n_trials" class="w-full p-2 rounded border bg-[var(--surface)] text-[var(--text)]" />
  </div>

  <div class="relative">
    <label class="block text-sm font-medium text-[var(--text)] flex items-center gap-2">
      Tune - Components
      <span class="relative group cursor-pointer inline-flex items-center text-gray-400">
        <span class="material-icons h-4 w-4 select-none mb-2">info</span>
        <div
          class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity z-50 whitespace-normal">
          How many parts or pieces the tuning model uses to analyze data.
          Using the right number helps find important patterns.
        </div>
      </span>
    </label>
    <input type="number" [(ngModel)]="tuneParams.no_components" class="w-full p-2 rounded border bg-[var(--surface)] text-[var(--text)]" />
  </div>
</div>


  <!-- === Action Buttons === -->
  <div class="flex flex-wrap gap-4 mt-4">
    <button
      class="px-5 py-2 bg-[var(--primary)] text-white rounded-lg hover:opacity-90 transition"
      (click)="trainModel()"
    >
      Train Model
    </button>

    <button
      class="px-5 py-2 bg-[var(--secondary)] text-white rounded-lg hover:opacity-90 transition"
      (click)="tuneModel()"
    >
      Tune Model
    </button>

    <button
      class="px-5 py-2 bg-lime-600 text-white rounded-lg hover:opacity-90 transition"
      (click)="getMetrics()"
    >
      Refresh Metrics
    </button>
  </div>

  <!-- === Loading Message === -->
  @if (loading) {
    <div class="text-sm text-yellow-500">Processing... Please wait.</div>
  }

  <!-- === Feedback Message === -->
  @if (message) {
    <div class="text-sm text-green-600">{{ message }}</div>
  }

  <!-- === Metrics and Config === -->
  @if (metrics) {
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- Evaluation Metrics -->
      <div class="bg-[var(--surface)] p-4 rounded-xl shadow">
        <h2 class="text-xl font-semibold mb-2 text-[var(--primary)]">Evaluation Metrics</h2>
        <ul class="text-sm space-y-1">
          <li><strong>Precision:</strong> {{ metrics['precision@5'] | number:'1.2-2' }}</li>
          <li><strong>Recall:</strong> {{ metrics['recall@5'] | number:'1.2-2' }}</li>
          <li><strong>AUC Score:</strong> {{ metrics.auc | number:'1.2-2' }}</li>
        </ul>
      </div>

      <!-- Model Configuration -->
      <div class="bg-[var(--surface)] p-4 rounded-xl shadow">
        <h2 class="text-xl font-semibold mb-2 text-[var(--primary)]">Model Configuration</h2>
        @if (currentConfig) {
          <ul class="text-sm space-y-1">
            <li><strong>Loss:</strong> {{ currentConfig.loss }}</li>
            <li><strong>Components:</strong> {{ currentConfig.no_components }}</li>
            <li><strong>Learning Rate:</strong> {{ currentConfig.learning_rate }}</li>
            <li><strong>Item Alpha:</strong> {{ currentConfig.item_alpha }}</li>
            <li><strong>User Alpha:</strong> {{ currentConfig.user_alpha }}</li>
            <li><strong>Max Sampled:</strong> {{ currentConfig.max_sampled }}</li>
            <li><strong>Epochs:</strong> {{ currentConfig.epochs }}</li>
            <li><strong>Threads:</strong> {{ currentConfig.num_threads }}</li>
          </ul>
        } @else {
          <p class="text-sm text-gray-500">No configuration available.</p>
        }
      </div>
    </div>
  }

  <!-- Training History -->
<div class="bg-[var(--surface)] p-4 rounded-xl shadow mt-6">
  <h2 class="text-xl font-semibold mb-2 text-[var(--primary)]">Training History</h2>

  @if (history.length > 0) {
    <ul class="text-sm list-disc list-inside">
      @for (run of history; track $index) {
        <li>
          {{ run.date }} â€“ Precision: {{ run['precision@5'] | number:'1.2-2' }}
        </li>
      }
    </ul>
  } @else {
    <p class="text-sm text-gray-500">No previous training runs.</p>
  }
</div>


</div>
